import type { StepSubmission, WorkflowRecord } from "@/types";

// Helper to create mock step submissions
function createMockSubmission(
  id: string,
  stepId: string,
  data: Record<string, unknown>,
  submittedAt: string,
  submittedById: string,
  submittedByUsername: string,
  status: StepSubmission["status"],
  reviewedAt?: string,
  reviewedById?: string,
  reviewedByUsername?: string,
): StepSubmission {
  return {
    id,
    workflow_record_id: "", // Will be set by parent
    step_id: stepId,
    form_name: "Mock Form",
    data,
    status,
    submitted_by_id: submittedById,
    submitted_by: { id: submittedById, username: submittedByUsername },
    submitted_at: submittedAt,
    ...(reviewedAt && { reviewed_at: reviewedAt }),
    ...(reviewedById && {
      reviewed_by_id: reviewedById,
      reviewed_by: { id: reviewedById, username: reviewedByUsername || "" },
    }),
    created_at: submittedAt,
    updated_at: reviewedAt || submittedAt,
  };
}

export const mockWorkflowRecords: WorkflowRecord[] = [
  // Tree 001 - Completed assessment
  {
    id: "wr-001",
    entity_id: "ent-tree-001",
    workflow_id: "wf-tree-assessment",
    workflow: { id: "wf-tree-assessment", name: "Palm Tree Assessment" },
    current_step_id: null,
    current_step: null,
    status: "completed",
    step_submissions: [
      createMockSubmission(
        "sub-001-1",
        "step-initial-check",
        {
          condition: "good",
          visualIssues: "None observed",
          notes: "Tree looks healthy",
        },
        "2024-03-10T10:00:00Z",
        "user-001",
        "John Smith",
        "approved",
        "2024-03-10T10:30:00Z",
        "user-mgr-001",
        "Manager A",
      ),
      createMockSubmission(
        "sub-001-2",
        "step-detailed-assessment",
        {
          trunkCondition: "healthy",
          crownCondition: "healthy",
          pestPresence: false,
          estimatedYield: 45,
        },
        "2024-03-10T11:30:00Z",
        "user-001",
        "John Smith",
        "approved",
        "2024-03-10T12:00:00Z",
        "user-mgr-001",
        "Manager A",
      ),
      createMockSubmission(
        "sub-001-3",
        "step-final-review",
        {
          recommendation: "no_action",
          priority: "low",
          followUpDate: "2024-09-10",
          summary: "Tree is in excellent condition. No action required.",
        },
        "2024-03-10T14:00:00Z",
        "user-001",
        "John Smith",
        "submitted",
      ),
    ],
    started_at: "2024-03-10T10:00:00Z",
    completed_at: "2024-03-10T14:00:00Z",
    created_at: "2024-03-10T09:00:00Z",
    updated_at: "2024-03-10T14:00:00Z",
  },
  // Tree 002 - In progress (at step 2)
  {
    id: "wr-002",
    entity_id: "ent-tree-002",
    workflow_id: "wf-tree-assessment",
    workflow: { id: "wf-tree-assessment", name: "Palm Tree Assessment" },
    current_step_id: "step-detailed-assessment",
    current_step: {
      id: "step-detailed-assessment",
      name: "Detailed Assessment",
      order_index: 1,
    },
    status: "in_progress",
    step_submissions: [
      createMockSubmission(
        "sub-002-1",
        "step-initial-check",
        {
          condition: "fair",
          visualIssues: "Some yellowing on leaves",
          notes: "Needs closer inspection",
        },
        "2024-03-12T09:30:00Z",
        "user-002",
        "Jane Doe",
        "approved",
        "2024-03-12T10:00:00Z",
        "user-mgr-002",
        "Manager B",
      ),
    ],
    started_at: "2024-03-12T09:30:00Z",
    completed_at: null,
    created_at: "2024-03-12T09:00:00Z",
    updated_at: "2024-03-12T09:30:00Z",
  },
  // Tree 005 - Not started
  {
    id: "wr-003",
    entity_id: "ent-tree-005",
    workflow_id: "wf-tree-assessment",
    workflow: { id: "wf-tree-assessment", name: "Palm Tree Assessment" },
    current_step_id: "step-initial-check",
    current_step: {
      id: "step-initial-check",
      name: "Initial Check",
      order_index: 0,
    },
    status: "not_started",
    step_submissions: [],
    started_at: null,
    completed_at: null,
    created_at: "2024-03-14T00:00:00Z",
    updated_at: "2024-03-14T00:00:00Z",
  },
  // Equipment 002 - In progress maintenance
  {
    id: "wr-004",
    entity_id: "ent-equip-002",
    workflow_id: "wf-equipment-maintenance",
    workflow: {
      id: "wf-equipment-maintenance",
      name: "Equipment Maintenance",
    },
    current_step_id: "step-maintenance-work",
    current_step: {
      id: "step-maintenance-work",
      name: "Maintenance Work",
      order_index: 1,
    },
    status: "in_progress",
    step_submissions: [
      createMockSubmission(
        "sub-004-1",
        "step-pre-inspection",
        {
          operatingHours: 1250,
          visualCondition: "wear",
          fluidLevels: "low",
        },
        "2024-03-15T08:00:00Z",
        "user-003",
        "Tech Mike",
        "submitted",
      ),
    ],
    started_at: "2024-03-15T08:00:00Z",
    completed_at: null,
    created_at: "2024-03-15T07:30:00Z",
    updated_at: "2024-03-15T08:00:00Z",
  },
  // Plot 001 - Completed inspection with rejection example
  {
    id: "wr-005",
    entity_id: "ent-plot-001",
    workflow_id: "wf-plot-inspection",
    workflow: { id: "wf-plot-inspection", name: "Plot Inspection" },
    current_step_id: null,
    current_step: null,
    status: "completed",
    step_submissions: [
      createMockSubmission(
        "sub-005-1",
        "step-boundary-check",
        {
          boundaryIntact: true,
          fencingCondition: "good",
          accessPoints: 2,
        },
        "2024-03-08T09:00:00Z",
        "user-004",
        "Field Agent A",
        "approved",
        "2024-03-08T09:30:00Z",
        "user-sup-001",
        "Supervisor X",
      ),
      createMockSubmission(
        "sub-005-2a",
        "step-soil-analysis",
        {
          phLevel: 5.2,
          moistureLevel: "low",
          nutrientStatus: "poor",
        },
        "2024-03-08T10:00:00Z",
        "user-004",
        "Field Agent A",
        "rejected",
        "2024-03-08T10:30:00Z",
        "user-sup-001",
        "Supervisor X",
      ),
      createMockSubmission(
        "sub-005-2b",
        "step-soil-analysis",
        {
          phLevel: 6.8,
          moistureLevel: "optimal",
          nutrientStatus: "adequate",
        },
        "2024-03-08T11:00:00Z",
        "user-004",
        "Field Agent A",
        "approved",
        "2024-03-08T11:30:00Z",
        "user-sup-001",
        "Supervisor X",
      ),
      createMockSubmission(
        "sub-005-3",
        "step-vegetation-survey",
        {
          treeCount: 45,
          weedPresence: "light",
          diseaseIndicators: false,
        },
        "2024-03-08T14:00:00Z",
        "user-004",
        "Field Agent A",
        "approved",
        "2024-03-08T14:30:00Z",
        "user-sup-001",
        "Supervisor X",
      ),
      createMockSubmission(
        "sub-005-4",
        "step-report-generation",
        {
          overallRating: "good",
          recommendations: "Continue current maintenance schedule",
          nextInspectionDate: "2024-06-08",
        },
        "2024-03-08T16:00:00Z",
        "user-004",
        "Field Agent A",
        "submitted",
      ),
    ],
    started_at: "2024-03-08T09:00:00Z",
    completed_at: "2024-03-08T16:00:00Z",
    created_at: "2024-03-08T08:00:00Z",
    updated_at: "2024-03-08T16:00:00Z",
  },
];

// Entity type to workflow assignments
export const mockEntityTypeWorkflows: Record<string, string[]> = {
  "et-palm-tree": [
    "wf-tree-assessment",
    "wf-pest-control",
    "wf-fertilizer-application",
  ],
  "et-plot": ["wf-plot-inspection", "wf-harvest-cycle", "wf-new-planting"],
  "et-equipment": ["wf-equipment-maintenance"],
  "et-worker": ["wf-safety-training", "wf-worker-onboarding"],
};
